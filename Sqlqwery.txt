CREATE TABLE customers (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100),
    email VARCHAR(100),
    address VARCHAR(255)
);
CREATE TABLE products (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100),
    price DECIMAL(10, 2),
    description TEXT
);
CREATE TABLE orders (
    id INT AUTO_INCREMENT PRIMARY KEY,
ordercustomer_id INT,
order_date DATE,
    total_amount DECIMAL(10, 2),
    FOREIGN KEY (customer_id) REFERENCES customers(id)
);
INSERT INTO customers (name, email, address) VALUES
('Alice Johnson', 'alice@example.com', '123 Maple St'),
('Bob Smith', 'bob@example.com', '456 Oak Ave'),
('Charlie Davis', 'charlie@example.com', '789 Pine Rd'),('David Lee', 'david.lee@example.com', '321 Elm Street'),
('Emma Wilson', 'emma.w@example.com', '654 Birch Blvd'),
('Frank Miller', 'frank.m@example.com', '987 Cedar Court'),
('Grace Kim', 'grace.kim@example.com', '111 Spruce Lane'),
('Helen White', 'helen.white@example.com', '202 Willow Way');

SELECT * FROM customers;
DELETE FROM customers;
INSERT INTO customers (name, email, address) VALUES
('John', 'john@example.com', 'Chennai'),
('Mary', 'mary@example.com', 'Madurai'),
('Alex', 'alex@example.com', 'Coimbatore'),
('Sara', 'sara@example.com', 'Trichy'),
('David', 'david@example.com', 'Salem'),
('Emma', 'emma@example.com', 'Erode'),
('Liam', 'liam@example.com', 'Nagercoil'),
('Sophia', 'sophia@example.com', 'Thoothukudi');
SELECT * FROM customers;
USE mysqltask1;
SELECT * FROM customers;






INSERT INTO products (name, price, description) VALUES
('Product A', 30.00, 'Description for Product A'),
('Product B', 25.50, 'Description for Product B'),
('Product C', 50.00, 'Description for Product C'),
('Product D', 70.00, 'Description for Product D'),
('Product E', 30.00, 'Description for Product E'),
('Product F', 25.50, 'Description for Product F'),
('Product G', 50.00, 'Description for Product G'),
('Product H', 70.00, 'Description for Product H');
INSERT INTO orders (customer_id, order_date, total_amount) VALUES
(1, CURDATE() - INTERVAL 10 DAY, 80.00),
(2, CURDATE() - INTERVAL 40 DAY, 60.00),
(3, CURDATE() - INTERVAL 5 DAY, 150.00),
(4, CURDATE() - INTERVAL 20 DAY, 120.00),
(5, CURDATE() - INTERVAL 3 DAY, 200.00),
(6, CURDATE() - INTERVAL 15 DAY, 90.00),
(7, CURDATE() - INTERVAL 1 DAY, 175.00),
(8, CURDATE() - INTERVAL 8 DAY, 135.00);
SELECT * FROM customers;
-- Retrieve all customers who have placed an order in the last 30 days.

SELECT DISTINCT c.id, c.name, c.email, c.address
FROM customers c
JOIN orders o ON c.id = o.customer_id
WHERE o.order_date >= CURDATE() - INTERVAL 30 DAY;

-- Get the total amount of all orders placed by each customer.
-- SELECT 
--     c.id AS customer_id,
--     c.name AS customer_name,
--     SUM(o.amount) AS total_amount FROM customers c
-- JOIN orders o ON c.id = o.customer_id
-- GROUP BY c.id, c.name;
-- DESCRIBE orders;

SELECT 
    c.id AS customer_id, 
    c.name AS customer_name, 
    SUM(o.total) AS total_amount 
FROM customers c 
JOIN orders o ON c.id = o.customer_id 
GROUP BY c.id, c.name 
LIMIT 0, 1000;

-- Update the price of Product C to 45.00.


UPDATE products 
SET name = 'product c', price = 45, description = 'Description for Product C'
WHERE id= 3 ;
select * from products

-- Add a new column discount to the products table.
ALTER TABLE products ADD COLUMN discounts ;

-- Retrieve the top 3 products with the highest price.

SELECT * FROM products ORDER BY price  DESC LIMIT 3 offset 2;

-- Get the names of customers who have ordered Product A.
CREATE TABLE order_items (
    id INT AUTO_INCREMENT PRIMARY KEY,
    order_id INT,
    product_id INT,
    quantity INT,
    FOREIGN KEY (order_id) REFERENCES orders(id),
    FOREIGN KEY (product_id) REFERENCES products(id)
);
INSERT INTO order_items (order_id, product_id, quantity) VALUES
(1, 1, 2), -- Customer 1 ordered Product A
(2, 2, 1),
(3, 1, 1), -- Customer 3 ordered Product A
(4, 3, 1),
(5, 4, 2);
SELECT id FROM orders;
INSERT INTO order_items (order_id, product_id, quantity) VALUES
(1, 1, 2),  -- Product A
(2, 2, 1),
(3, 1, 1),  -- Product A
(4, 3, 1),
(5, 4, 2),
(6, 1, 1),  -- Product A
(7, 2, 2),
(8, 3, 1);
SELECT id, customer_id, order_date, total_amount FROM orders;





SELECT DISTINCT c.name
FROM customers c
JOIN orders o ON c.id = o.ordercustomer_id
JOIN order_items oi ON o.id = oi.order_id
JOIN products p ON oi.product_id = p.id
WHERE p.name = 'Product A';
DROP TABLE IF EXISTS order_items;
DROP TABLE IF EXISTS orders;
CREATE TABLE orders (
    id INT AUTO_INCREMENT PRIMARY KEY,
    customer_id INT,
    order_date DATE,
    total_amount DECIMAL(10, 2),
    FOREIGN KEY (customer_id) REFERENCES customers(id)
);
INSERT INTO orders (customer_id, order_date, total_amount) VALUES
(1, CURDATE() - INTERVAL 10 DAY, 80.00),
(2, CURDATE() - INTERVAL 40 DAY, 60.00),
(3, CURDATE() - INTERVAL 5 DAY, 150.00),
(4, CURDATE() - INTERVAL 20 DAY, 120.00),
(5, CURDATE() - INTERVAL 3 DAY, 200.00),
(6, CURDATE() - INTERVAL 15 DAY, 90.00),
(7, CURDATE() - INTERVAL 1 DAY, 175.00),
(8, CURDATE() - INTERVAL 8 DAY, 135.00);
SELECT id FROM orders;
CREATE TABLE order_items (
    id INT AUTO_INCREMENT PRIMARY KEY,
    order_id INT,
    product_id INT,
    quantity INT,
    FOREIGN KEY (order_id) REFERENCES orders(id),
    FOREIGN KEY (product_id) REFERENCES products(id)
);
INSERT INTO order_items (order_id, product_id, quantity) VALUES
(1, 1, 2),  -- Product A
(2, 2, 1),
(3, 1, 1),  -- Product A
(4, 3, 1),
(5, 4, 2),
(6, 1, 1),  -- Product A
(7, 2, 2),
(8, 3, 1);
SELECT DISTINCT c.name
FROM customers c
JOIN orders o ON c.id = o.customer_id
JOIN order_items oi ON o.id = oi.order_id
JOIN products p ON oi.product_id = p.id
WHERE p.name = 'Product A';
 select * from products
 
 

 

SELECT * FROM customers;
SELECT id, name, email FROM customers;


SELECT COUNT(*) AS total_customers FROM customers;

//-- Join the orders and customers tables to retrieve the customer's name and order date for each order. 
SELECT c.name AS customer_name, o.order_date, o.total_amount
FROM orders o
JOIN customers c ON o.customer_id = c.id;


SELECT o.id AS order_id, c.name AS customer_name, o.order_date, o.total_amount
FROM orders o
JOIN customers c ON o.customer_id = c.id
WHERE o.total_amount > 150.00;


-- Normalize the database by creating a separate table for order items and updating the orders table to reference the order_items table.

CREATE TABLE orders (
    id INT AUTO_INCREMENT PRIMARY KEY,
    customer_id INT,
    order_date DATE,
    total_amount DECIMAL(10,2),
    FOREIGN KEY (customer_id) REFERENCES customers(id)
);

INSERT INTO orders (customer_id, order_date, total_amount) VALUES
(1, CURDATE() - INTERVAL 10 DAY, 80.00),
(2, CURDATE() - INTERVAL 40 DAY, 60.00),
(3, CURDATE() - INTERVAL 5 DAY, 150.00),
(4, CURDATE() - INTERVAL 20 DAY, 120.00),
(5, CURDATE() - INTERVAL 3 DAY, 200.00),
(6, CURDATE() - INTERVAL 15 DAY, 90.00),
(7, CURDATE() - INTERVAL 1 DAY, 175.00),
(8, CURDATE() - INTERVAL 8 DAY, 135.00);
CREATE TABLE order_items (
    id INT AUTO_INCREMENT PRIMARY KEY,
    order_id INT NOT NULL,
    product_id INT NOT NULL,
    quantity INT NOT NULL,
    FOREIGN KEY (order_id) REFERENCES orders(id),
    FOREIGN KEY (product_id) REFERENCES products(id)
);
INSERT INTO order_items (order_id, product_id, quantity) VALUES
(1, 1, 2),
(1, 2, 1),
(2, 3, 1),
(2, 4, 2),
(3, 1, 1),
(3, 5, 3),
(4, 2, 2),
(4, 6, 1),
(5, 4, 2),
(5, 7, 1),
(6, 3, 1),
(6, 8, 2),
(7, 5, 1),
(7, 1, 2),
(8, 6, 3),
(8, 2, 1);
SELECT * FROM orders;


INSERT INTO orders (customer_id, order_date, total_amount) VALUES
(1, CURDATE() - INTERVAL 10 DAY, 80.00),
(2, CURDATE() - INTERVAL 40 DAY, 60.00),
(3, CURDATE() - INTERVAL 5 DAY, 150.00),
(4, CURDATE() - INTERVAL 20 DAY, 120.00),
(5, CURDATE() - INTERVAL 3 DAY, 200.00),
(6, CURDATE() - INTERVAL 15 DAY, 90.00),
(7, CURDATE() - INTERVAL 1 DAY, 175.00),
(8, CURDATE() - INTERVAL 8 DAY, 135.00);

INSERT INTO customers (name, email, address) VALUES
('John', 'john@example.com', 'Chennai'),
('Mary', 'mary@example.com', 'Madurai'),
('Alex', 'alex@example.com', 'Coimbatore'),
('Sara', 'sara@example.com', 'Trichy'),
('David', 'david@example.com', 'Salem'),
('Emma', 'emma@example.com', 'Erode'),
('Liam', 'liam@example.com', 'Nagercoil'),
('Sophia', 'sophia@example.com', 'Thoothukudi');
INSERT INTO orders (customer_id, order_date, total_amount) VALUES
(1, CURDATE() - INTERVAL 10 DAY, 80.00),
(2, CURDATE() - INTERVAL 40 DAY, 60.00),
(3, CURDATE() - INTERVAL 5 DAY, 150.00),
(4, CURDATE() - INTERVAL 20 DAY, 120.00),
(5, CURDATE() - INTERVAL 3 DAY, 200.00),
(6, CURDATE() - INTERVAL 15 DAY, 90.00),
(7, CURDATE() - INTERVAL 1 DAY, 175.00),
(8, CURDATE() - INTERVAL 8 DAY, 135.00);
SELECT o.id AS order_id, 
       SUM(p.price * oi.quantity) AS total_amount
FROM orders o
JOIN order_items oi ON o.id = oi.order_id
JOIN products p ON oi.product_id = p.id
GROUP BY o.id;


-- Retrieve the orders with a total amount greater than 150.00.-- 
SELECT 
    o.id AS order_id,
    c.name AS customer_name,
    o.order_date,
    SUM(p.price * oi.quantity) AS total_amount
FROM orders o
JOIN customers c ON o.customer_id = c.id
JOIN order_items oi ON o.id = oi.order_id
JOIN products p ON oi.product_id = p.id
GROUP BY o.id, c.name, o.order_date
HAVING total_amount > 150;


-- Retrieve the average total of all orders.
SELECT 
    AVG(order_total) AS average_order_total
FROM (
    SELECT 
        o.id AS order_id,
        SUM(p.price * oi.quantity) AS order_total
    FROM orders o
    JOIN order_items oi ON o.id = oi.order_id
    JOIN products p ON oi.product_id = p.id
    GROUP BY o.id
) AS order_totals;


